<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loja Express - Produtos</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fff8e7; margin: 0; padding: 0; }
    header { background: #ffcc00; color: #4b0082; padding: 1rem; text-align: center; font-size: 1.5rem; font-weight: bold; }

    /* PRODUTOS */
    .produtos { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.8rem; padding: 0.8rem; }
    .produto {
      background: #fff; border: 2px solid #4b0082; border-radius: 10px; padding: 0.8rem; text-align: center;
      display: flex; flex-direction: column; justify-content: space-between; min-height: 220px; transition: all 0.3s ease;
    }
    .produto img { width: 100%; max-width: 140px; height: 140px; object-fit: contain; cursor: pointer; margin: 0 auto; }
    .produto h3 { margin: 0.5rem 0; color: #4b0082; cursor: pointer; font-size: 1rem; }
    .produto p {
      font-size: 0.9rem;
      color: #222;
      display: none;
      margin-top: 0.5rem;
      background: #f7f2ff;
      padding: 0.5rem;
      border-left: 4px solid #4b0082;
      border-radius: 6px;
      font-style: italic;
    }
    .produto button { background: #4b0082; color: #fff; border: none; padding: 0.5rem 0.8rem; border-radius: 5px; cursor: pointer; font-size: 0.9rem; margin-top: 0.5rem; }
    .produto button:hover { background: #36005d; }

    /* CARRINHO */
    #carrinho { background: #eee; padding: 1rem; border-top: 3px solid #4b0082; margin-top: 0.5rem; }
    #itensCarrinho { list-style: none; padding: 0; margin: 0; }
    #itensCarrinho li { display: flex; justify-content: space-between; align-items: center; background: #fff; padding: 0.4rem 0.5rem; margin: 0.2rem 0; border: 1px solid #ccc; border-radius: 5px; font-size: 0.9rem; }
    .remover { background: red; color: #fff; border: none; border-radius: 5px; padding: 0.25rem 0.5rem; cursor: pointer; font-size: 0.8rem; margin-left: 8px; }
    #finalizar { margin-top: 0.8rem; background: #ffcc00; color: #4b0082; border: none; padding: 0.6rem 1rem; font-weight: bold; border-radius: 8px; cursor: pointer; width: 100%; font-size: 1rem; }

    .cart-left { display:flex; align-items:center; gap:10px; }

    .item-thumb { width:48px; height:48px; object-fit:cover; border-radius:6px; }

    .small-btn {
      background: transparent;
      border: 1px solid #4b0082;
      color: #4b0082;
      padding: 0.4rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      margin-right: 8px;
    }
    .small-btn:hover { background:#f7f2ff; }

    /* RESPONSIVIDADE */
    @media (max-width: 600px) {
      .produtos { grid-template-columns: repeat(2, 1fr); gap: 0.5rem; padding: 0.5rem; }
      .produto img { height: 130px; }
    }
  </style>
</head>
<body>
  <header>🛒 Loja Express</header>

  <section class="produtos" id="listaProdutos"></section>

  <section id="carrinho">
    <h2>🛒 Carrinho</h2>
    <ul id="itensCarrinho"></ul>
    <p><strong>Total: R$ <span id="total">0.00</span></strong></p>

    <div style="display:flex; gap:8px;">
      <button id="limpar" class="small-btn">Limpar Carrinho</button>
      <button id="finalizar">Seguir para revisão</button>
    </div>
  </section>

  <script>
    // Produtos (mantive exatamente como você enviou)
    const produtos = [
      {nome: "Cabo carregador", preco: 15, desc: "Cabo de carregador disponível nos modelos: <strong>Tipo C e Lighint (IPhone)</strong>. Uma ponta USB, outra ponta carregador. Não acompanha fonte.", img: "img-loja/Foto1.jpg"},
      {nome: "Fone de Ouvido Bluetooth", preco: 20, desc: "Fone de ouvido sem fio com cancelamento de ruído e microfone intra-auricular. Confortável, potente e com carregamento rápido. Autonomia de até <strong>4 horas.</strong> Acompanha: <strong>Par de fones + Caixa de carregamento + cabo USB + manual.</strong>", img: "img-loja/Foto2.jpg"},
      {nome: "Guarda-Chuva", preco: 35, desc: "Guarda-chuva compacto e reforçado, cabe em sua bolsa. (cores conforme disponibilidade)", img: "img-loja/Foto3.jpg"},
      {nome: "Power Bank (Carregador portátil)", preco: 40, desc: "Carregador Portátil Power Bank 10000mah com 3 Saídas: <strong>Tipo C, lighting (iphone) e V8 (micro USB).</strong>", img: "img-loja/Foto4.jpg"},
      {nome: "Kit Fonte + Cabo Carregador", preco: 25, desc: "Kit Carregador completo 1.2A, incluso <strong>fonte + cabo de carregamento.</strong> Disponível para <strong>Tipo C e Lighing (IPhone).</strong>", img: "img-loja/Foto5.jpg"},
      {nome: "Cabo carregador USB 3 em 1", preco: 20, desc: "<strong>COMPATIBILIDADE UNIVERSAL: </strong>Cabo 3 em 1 com conectores: <strong>Tipo-C, Lightning (IPhone), e Micro USB (V8)</strong>, permitindo carregar diversos dispositivos com um único cabo.", img: "img-loja/Foto6.jpg"},
      {nome: "Fone com microfone", preco: 10, desc: "Fone com com fio e microfone, entrada P2.", img: "img-loja/Foto7.jpg"},
      {nome: "", preco: 0, desc: "Produto indisponível temporariamente", img: "img-loja/Foto8.jpg"}
    ];

    // cart será carregado do localStorage (se existir)
    let cart = {};

    const lista = document.getElementById("listaProdutos");

    // montar grid de produtos
    produtos.forEach((p, idx) => {
      const div = document.createElement("div");
      div.className = "produto";
      div.innerHTML = `
        <img src="${p.img}" alt="${p.nome}" onclick="toggleDescription(this)" />
        <h3 onclick="toggleDescription(this)">${p.nome || 'Sem nome'}</h3>
        <p>${p.desc}</p>
        <button onclick="addToCart(${idx}, event)">Adicionar - R$${p.preco.toFixed(2)}</button>
      `;
      lista.appendChild(div);
    });

    function toggleDescription(el){
      const p = el.closest(".produto").querySelector("p");
      p.style.display = (p.style.display === "block") ? "none" : "block";
    }

    function addToCart(index, e){
      e.stopPropagation();
      const p = produtos[index];
      const key = p.nome || `produto-${index}`;
      if(cart[key]) cart[key].qtd++;
      else cart[key] = { price: p.preco, qtd: 1, img: p.img, nome: p.nome };
      saveCartToStorage();
      renderCart();
    }

    function removeFromCart(key){
      if(cart[key]){
        cart[key].qtd--;
        if(cart[key].qtd <= 0) delete cart[key];
        saveCartToStorage();
        renderCart();
      }
    }

    function renderCart(){
      const ul = document.getElementById("itensCarrinho");
      ul.innerHTML = "";
      let total = 0;
      for(let k in cart){
        const item = cart[k];
        const subtotal = item.price * item.qtd;
        const li = document.createElement("li");
        li.innerHTML = `
          <div class="cart-left">
            <img src="${item.img}" class="item-thumb" alt="">
            <div>
              <div><strong>${item.nome || k}</strong></div>
              <div style="font-size:0.85rem; color:#666;">x${item.qtd}</div>
            </div>
          </div>
          <div style="display:flex; align-items:center; gap:8px;">
            <div>R$ ${subtotal.toFixed(2)}</div>
            <button class="remover">X</button>
          </div>
        `;
        // botão remover com listener (evita problemas de escape em nomes)
        li.querySelector('.remover').addEventListener('click', () => removeFromCart(k));
        ul.appendChild(li);
        total += subtotal;
      }
      document.getElementById("total").innerText = total.toFixed(2);

      // caso existam outras páginas que consultem resumoTotal, atualiza quando existir
      const resumoEl = document.getElementById('resumoTotal');
      if(resumoEl) resumoEl.innerText = total.toFixed(2);
    }

    function saveCartToStorage(){
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function loadCartFromStorage(){
      const s = localStorage.getItem('cart');
      if(s){
        try {
          cart = JSON.parse(s) || {};
        } catch(e) {
          cart = {};
        }
      } else cart = {};
      renderCart();
    }

    // limpar carrinho
    document.getElementById('limpar').addEventListener('click', () => {
      if(Object.keys(cart).length === 0) return;
      if(confirm('Deseja limpar todo o carrinho?')) {
        cart = {};
        saveCartToStorage();
        renderCart();
      }
    });

    // finalizar -> redireciona para a página de revisão (próxima etapa)
    document.getElementById('finalizar').addEventListener('click', () => {
      if(Object.keys(cart).length === 0) { alert('Seu carrinho está vazio!'); return; }
      // vamos para a página de revisão (revisao.html). Eu crio ela na próxima etapa.
      window.location.href = 'revisao.html';
    });

    // carregar cart no carregamento da página
    loadCartFromStorage();
  </script>
</body>
</html>